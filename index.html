<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='Functions to capture, inspect, manipulate, and create
             lazy values (promises), "..." lists, and active calls.'>
<title>Tools for Lazy and Non-Standard Evaluation • nseval</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Lazy and Non-Standard Evaluation">
<meta property="og:description" content='Functions to capture, inspect, manipulate, and create
             lazy values (promises), "..." lists, and active calls.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">nseval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="the-nseval-package-utilities-for-controlling-non-standard-evaluation">The <code>nseval</code> Package: Utilities for Controlling Non-standard Evaluation<a class="anchor" aria-label="anchor" href="#the-nseval-package-utilities-for-controlling-non-standard-evaluation"></a>
</h1></div>
<p><!-- badges: start --> <a href="https://github.com/crowding/nseval/actions" class="external-link"><img src="https://github.com/crowding/nseval/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://cran.r-project.org/package=nseval" class="external-link"><img src="http://www.r-pkg.org/badges/version/nseval" alt="CRAN version badge"></a><a href="https://app.codecov.io/gh/crowding/nseval?branch=main" class="external-link"><img src="https://codecov.io/gh/crowding/nseval/branch/main/graph/badge.svg" alt="Codecov test coverage"></a> <!-- badges: end --></p>
<p><code>nseval</code> is the missing API for non-standard evaluation and metaprogramming in R.</p>
<div class="section level3">
<h3 id="who-nseval-is-for">Who <code>nseval</code> is for<a class="anchor" aria-label="anchor" href="#who-nseval-is-for"></a>
</h3>
<p><code>nseval</code> might be for you if:</p>
<ul>
<li>You’ve been befuddled by trying to get your desired results using functions like <code>substitute</code>, <code>eval</code>, <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>, <code>do.call</code>, <code>match.call</code>, and other cases of <a href="http://adv-r.had.co.nz/Computing-on-the-language.html" class="external-link">non-standard evauation</a>;</li>
<li>You’re been befuddled by trying to interface with other people’s code that uses the above functions, and need a way to work around them;</li>
<li>You want to better understand what “goes on” “under the hood” when R is running.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>nseval</code> is on CRAN, install the latest release with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"nseval"</span>)</span></code></pre></div>
<p>To install the development branch:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"crowding/nseval"</span>)</span></code></pre></div>
<div class="section level3">
<h3 id="what-nseval-does">What <code>nseval</code> does<a class="anchor" aria-label="anchor" href="#what-nseval-does"></a>
</h3>
<p><code>nseval</code> introduces two S3 classes: <code>quotation</code>, and <code>dots</code>, which mirror R’s promises and <code>...</code>, respectively. Unlike their counterparts, these are ordinary data objects, and can be assigned to variables and be manipulated without triggering evaluation.</p>
<ul>
<li>A <code>quotation</code> combines an R expression with an environment. There are also <code>forced</code> quotations, which pair an expression with a value.</li>
<li>A <code>dots</code> is a named list of quotations.</li>
</ul>
<p>There is a set of consistently-named accessors and constructors for capturing, constructing, and manipulating these objects.</p>
</div>
</div>
<div class="section level2">
<h2 id="quick-intro--transitioning-from-base-r-to-nseval">Quick intro / transitioning from base R to <code>nseval</code>
<a class="anchor" aria-label="anchor" href="#quick-intro--transitioning-from-base-r-to-nseval"></a>
</h2>
<ul>
<li>Instead of <code>quote</code>, use:
<ul>
<li>
<code>quo</code>. This captures the environment along with the text of its argument.</li>
<li>Similarly, <code><a href="reference/dots.html">dots()</a></code> captures multiple arguments, analagously to <code>alist</code>.</li>
</ul>
</li>
<li>Instead of <code>substitute(x)</code>, use:
<ul>
<li>
<code>arg(x)</code>, which captures the argument’s environment along with its text.</li>
</ul>
</li>
<li>Instead of <code>substitute(list(...))[[2]]</code>, or <code>substitute(...())</code>, use:
<ul>
<li>
<code>dots(...)</code>, to capture <code>...</code> unevaluated, including original environments, or</li>
<li>
<code>arg_list(x, y, (...))</code>, to include other arguments as well.</li>
</ul>
</li>
<li>Instead of <code>match.call</code>, use:
<ul>
<li>
<code>get_call</code>, which preserves the environment attached to each argument.</li>
</ul>
</li>
<li>Instead of <code>do.call</code>, use
<ul>
<li>
<code>do</code>, which allows different arguments to be passed from different environments.</li>
</ul>
</li>
<li>Instead of <code>parent.frame</code>, use:
<ul>
<li>
<code>arg_env</code>, which gives the environment <em>attached to an argument</em> (recognizing that this can be different for different arguments!)</li>
<li>
<code>caller</code>, which returns the calling environment, like <code>parent.frame</code> often does, but avoids the latter’s difficulties with lazy evaluation and closures; <code>caller</code> would rather throw an error than return an incorrect result.</li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="why-nseval-is-needed">Why <code>nseval</code> is needed<a class="anchor" aria-label="anchor" href="#why-nseval-is-needed"></a>
</h3>
<p>Before R, there was S, and S had some metaprogramming facilities, exposed by functions like <code>parent.frame</code>, <code>substitute</code>, <code>match.call</code>, <code>do.call</code>, <code>quote</code>, <code>alist</code>, <code>eval</code>, and so on. R duplicated that API. But S did not have lexical scoping, closures, or the notion of an environment, whereas R has all those things.</p>
<p>In S, lazily evaluated arguments could be evaluated simply by stepping one step up in the call stack and evaluating them in that context. This is not the case with R, because environments can come from different sources via <code>...</code>, drop off the stack, and then be re-activated via closures (and these situations happen frequently enough in everyday code).</p>
<p>So R has been coping with a metaprogramming API that was not designed with R’s capabilities in mind. Because the S interface is not sufficient to model R behavior, we end up with consequences such as:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call()</a></code> loses information about argument scopes, so normally occurring function calls often can’t be captured in a reproducible form;</li>
<li>
<code>do.call</code> can’t reproduce many situations that occur in normal evaluation in R;</li>
<li>
<code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code> tells you something almost but not entirely unlike what you actually need to know in most situations;</li>
<li>it’s difficult to wrap or extend nonstandard-evaluating functions;</li>
<li>it’s difficult to use a nonstandard-evaluating function as an argument to a higher order function;</li>
<li>any mixture of metaprogramming and <code>...</code> rapidly turns painful;</li>
</ul>
<p>and so on. As a result, R functions that use the S metaprogramming API often end up with unintended behaviors that don’t “fit” R: they lose track of variable scope, suffer name collisions, are difficult to compose, etc.</p>
<p>The good news is that you can simply replace most uses of <code>match.call</code>, <code>parent.frame</code>, <code>do.call</code> and such with their equivalents from <code>nseval</code>, and may then have fewer of these kinds of problems.</p>
</div>
<div class="section level3">
<h3 id="what-nseval-doesnt-do">What <code>nseval</code> doesn’t do<a class="anchor" aria-label="anchor" href="#what-nseval-doesnt-do"></a>
</h3>
<p><code>nseval</code> doesn’t implement quasiquotation or hygeinic macros or code coverage or DSLs or interactive debugging. But it is intended to be a solid foundation to build those kinds of tools on! Watch this space.</p>
<p><code>nseval</code> doesn’t introduce any fancy syntax – the only nonstandard evaluation in its own interface is name lookup and quoting, and standard-evaluating equivalents are always also present.</p>
<p><code>nseval</code> doesn’t try and remake all of R’s base library, just the parts about calls and lazy evaluation.</p>
<p><code>nseval</code> has no install dependencies and should play well with base R or any other ’verse.</p>
</div>
</div>
<div class="section level2">
<h2 id="similar-packages">Similar packages<a class="anchor" aria-label="anchor" href="#similar-packages"></a>
</h2>
<p>Some other packages have tread similar ground:</p>
<ul>
<li><a href="https://github.com/r-lib/rlang" class="external-link">rlang</a></li>
<li><a href="https://github.com/hadley/lazyeval" class="external-link">lazyeval</a></li>
<li><a href="https://github.com/hadley/pryr" class="external-link">pryr</a></li>
<li>
<a href="https://github.com/crowding/vadr" class="external-link">vadr</a>, which this package is carved off and rewritten from.</li>
</ul>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>It turns out that R’s implementation of lazy evaluation via “promise” objects are effectively a recreation of <a href="https://en.wikipedia.org/wiki/Fexpr" class="external-link">fexprs</a> with lexical scope On the topic of how to work with fexprs, particularly in combination with lexical scope and environments, John Shutt’s 2010 <a href="https://digital.wpi.edu/concern/etds/ht24wj541?locale=en" class="external-link">PhD thesis</a> has been helpful.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=nseval" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2.0)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nseval</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Peter Meilstrup <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Peter Meilstrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
